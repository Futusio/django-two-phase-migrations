# Bluegreen Tests

TDD —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–∞—é—â–µ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∏ –≤—ã—è–≤–ª–µ–Ω–∏—è –±–∞–≥–æ–≤.

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

```
Ran 94 tests
‚úÖ 94 passed  (100%) - –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç!
‚ùå 0 failed   (0%)   - –í—Å–µ –±–∞–≥–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
```

## –ó–∞–ø—É—Å–∫

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
poetry run python manage.py test bluegreen

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ñ–∞–π–ª
poetry run python manage.py test bluegreen.tests.test_operation_splitting

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç
poetry run python manage.py test bluegreen.tests.test_operation_splitting.OperationReturnFormatTest.test_add_index_returns_tuples
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

### test_operation_splitting.py (24 —Ç–µ—Å—Ç–∞)
- ‚úÖ CreateModel/DeleteModel/AddField/RemoveField/AddConstraint —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ
- ‚úÖ AddIndex/RemoveIndex –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∫–æ—Ä—Ç–µ–∂–µ–π
- ‚úÖ RemoveConstraint isinstance —Å –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ Blue/Green –º–∏–≥—Ä–∞—Ü–∏–π
- ‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –º–∏–≥—Ä–∞—Ü–∏—è–º–∏
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è None –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ Edge cases (–ø—É—Å—Ç—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏, —Å–º–µ—à–∞–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)
- ‚úÖ –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### test_migrate_command.py (6 —Ç–µ—Å—Ç–æ–≤)
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–π –ø–æ --blue/--green —Ñ–ª–∞–≥–∞–º
- ‚úÖ isinstance –≤–º–µ—Å—Ç–æ __class__.__name__
- ‚úÖ SQL quote_name –≤ cursor.execute

### test_sql_safety.py (1 —Ç–µ—Å—Ç)
- ‚úÖ SQL-–∏–Ω—ä–µ–∫—Ü–∏–∏ –∑–∞—â–∏—â–µ–Ω—ã —á–µ—Ä–µ–∑ quote_name

### test_patched_operations.py (6 —Ç–µ—Å—Ç–æ–≤)
- ‚úÖ AddFieldPatched –∞—Ç—Ä–∏–±—É—Ç—ã –∏ deconstruct
- ‚úÖ CreateModelPatched –∞—Ç—Ä–∏–±—É—Ç—ã –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –ø–æ–ª–µ–π
- ‚úÖ AddIndexPatched –∞—Ç—Ä–∏–±—É—Ç—ã

### test_exceptions.py (4 —Ç–µ—Å—Ç–∞) üÜï
- ‚úÖ ImpossibleOperationError –≤ non-interactive —Ä–µ–∂–∏–º–µ
- ‚úÖ ModelNotFoundError –¥–ª—è –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–æ–¥–µ–ª–µ–π
- ‚úÖ –§–ª–∞–≥ --non-interactive –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç input()
- ‚úÖ –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –±–µ–∑ –ø–∞–¥–µ–Ω–∏—è

### test_schema_validation.py (5 —Ç–µ—Å—Ç–æ–≤) üÜï [–≠—Ç–∞–ø 1]
- ‚úÖ INSERT SELECT –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —è–≤–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ (–Ω–µ SELECT *)
- ‚úÖ INSERT SELECT –∏—Å–ø–æ–ª—å–∑—É–µ—Ç SQLBuilder
- ‚úÖ migrate.py –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- ‚úÖ bluegreen.py –∏—Å–ø–æ–ª—å–∑—É–µ—Ç quote_identifier
- ‚úÖ SQLBuilder –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç RunSQL —Å reverse_sql

### test_sql_builder.py (13 —Ç–µ—Å—Ç–æ–≤) üÜï [–≠—Ç–∞–ø 2]
- ‚úÖ INSERT SELECT –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Å –∫–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞–º–∏
- ‚úÖ INSERT SELECT –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —è–≤–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∫–æ–ª–æ–Ω–æ–∫ (–Ω–µ SELECT *)
- ‚úÖ UPDATE –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Å –∫–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞–º–∏
- ‚úÖ UPDATE —Å WHERE —É—Å–ª–æ–≤–∏–µ–º
- ‚úÖ –°–ø–∏—Å–æ–∫ –∫–æ–ª–æ–Ω–æ–∫ –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏–∑ –º–æ–¥–µ–ª–∏
- ‚úÖ –°–ø–∏—Å–æ–∫ –∫–æ–ª–æ–Ω–æ–∫ –∫–≤–æ—Ç–∏—Ä—É–µ—Ç—Å—è –∏ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç—Å—è
- ‚úÖ –ò–º—è —Ç–∞–±–ª–∏—Ü—ã —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ reverse_sql –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é - noop
- ‚úÖ –ö–∞—Å—Ç–æ–º–Ω—ã–π reverse_sql
- ‚úÖ –ü—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ –∫–æ–ª–æ–Ω–æ–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è
- ‚úÖ –°–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã –≤ –∏–º–µ–Ω–∞—Ö –∫–≤–æ—Ç–∏—Ä—É—é—Ç—Å—è

### test_sql_validators.py (13 —Ç–µ—Å—Ç–æ–≤) üÜï [–≠—Ç–∞–ø 2]
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ö–µ–º –∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –º–æ–¥–µ–ª–µ–π

### test_operation_splitter.py (11 —Ç–µ—Å—Ç–æ–≤) üÜï [–≠—Ç–∞–ø 3]
- ‚úÖ –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π (Model/Field/Index/Constraint)
- ‚úÖ OperationSplitter —Ä–∞–∑–¥–µ–ª—è–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞ blue/green

### test_config.py (6 —Ç–µ—Å—Ç–æ–≤) üÜï [–≠—Ç–∞–ø 4]
- ‚úÖ Enum –¥–ª—è —Ñ–∞–∑ –∏ –ø–æ–ª–∏—Ç–∏–∫
- ‚úÖ Dataclass –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### test_utils.py (10 —Ç–µ—Å—Ç–æ–≤) üÜï
- ‚úÖ get_model_safely –ø–æ–ª—É—á–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –º–æ–¥–µ–ª—å
- ‚úÖ get_model_safely –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç ModelNotFoundError
- ‚úÖ get_field_by_name –ø–æ–ª—É—á–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –ø–æ–ª–µ
- ‚úÖ get_field_by_name –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç FieldNotFoundError
- ‚úÖ get_index_by_name –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç IndexNotFoundError
- ‚úÖ quote_identifier –∫–≤–æ—Ç–∏—Ä—É–µ—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- ‚úÖ quote_identifiers –∫–≤–æ—Ç–∏—Ä—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤
- ‚úÖ format_operation_name –¥–ª—è CreateModel
- ‚úÖ format_operation_name –¥–ª—è AddField
- ‚úÖ format_operation_name –¥–ª—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### ‚úÖ –ü—É–Ω–∫—Ç 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –±–∞–≥–∏ (100%)
- ‚úÖ AddIndex/RemoveIndex - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∫–æ—Ä—Ç–µ–∂–µ–π
- ‚úÖ RemoveConstraint - isinstance —Å –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º
- ‚úÖ isinstance –≤–º–µ—Å—Ç–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –∏–º–µ–Ω –∫–ª–∞—Å—Å–æ–≤

### ‚úÖ –ü—É–Ω–∫—Ç 2: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å (100%)
- ‚úÖ SQL-–∏–Ω—ä–µ–∫—Ü–∏–∏ –∑–∞—â–∏—â–µ–Ω—ã —á–µ—Ä–µ–∑ connection.ops.quote_name()
- ‚úÖ INSERT SELECT –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —è–≤–Ω—ã–µ —Å–ø–∏—Å–∫–∏ –∫–æ–ª–æ–Ω–æ–∫
- ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –ø–µ—Ä–µ–Ω–æ—Å–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ö–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è (BlueGreenMigrationError –∏ –¥—Ä.)
- ‚úÖ –§–ª–∞–≥ --non-interactive –≤–º–µ—Å—Ç–æ input() –¥–ª—è CI/CD

### üìã –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- üÜï exceptions.py - –°–µ–º–µ–π—Å—Ç–≤–æ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π
- üÜï –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ö–µ–º –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–Ω–æ—Å–æ–º –¥–∞–Ω–Ω—ã—Ö
- üÜï –Ø–≤–Ω—ã–µ —Å–ø–∏—Å–∫–∏ –∫–æ–ª–æ–Ω–æ–∫ –≤ INSERT SELECT
- üÜï –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –ø–æ–Ω—è—Ç–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
- üÜï –ù–µ–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º –¥–ª—è CI/CD

## TDD –ø—Ä–æ—Ü–µ—Å—Å

```bash
# 1. –£–≤–∏–¥–µ—Ç—å failing —Ç–µ—Å—Ç—ã
poetry run python manage.py test bluegreen

# 2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –±–∞–≥
vim bluegreen/management/commands/bluegreen.py

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ç–µ—Å—Ç –ø—Ä–æ—à–µ–ª
poetry run python manage.py test bluegreen

# 4. –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ
```

–î–µ—Ç–∞–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –≤ `BUGS.md`
